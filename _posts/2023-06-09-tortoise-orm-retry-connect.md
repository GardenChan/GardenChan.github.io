---
layout: post
title: "tortoise-orm 支持数据库重连能力"
subtitle: "主备切换下如何从断开的数据库连接中恢复"
date: 2023-06-09
author: "Garden"
header-img: "img/post-bg-2015.jpg"
tags: ["Python","tortoise-orm","MySQL"]
---

# 背景
首先介绍一下什么是数据库重连以及为什么需要数据库重连。数据库重连指的是应用在操作数据库时，因为某些突发原因导致数据库连接被动断开，此时如果不予处理，请求将会报错，影响现网的业务流程。数据库重连就是在这种情况发生的时候，主动重新连接数据库，并重新执行数据库操作。在 ORM 层面，支持数据库重连能力，能够有效应对一些被动断开数据库连接的场景，最常见的就是主备切换。
许多 ORM 框架都提供数据库重连的能力，本文介绍如何让 tortoise-orm 具备数据库重连的能力。首先，我会提供一个主备切换的场景，和一个压测脚本，来模拟展示不具备数据库重连能力，你的服务将面临什么问题。再原有服务上进行重连改造，并测试具备重连能力后如何“丝滑”应对数据库的主备切换。

# 准备
Python 版本：3.8.0 以上
tortoise-orm 版本：17.2.0
云数据库 MySQL：5.7.0 以上
